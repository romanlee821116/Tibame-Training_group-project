<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>後台 - 消息管理</title>
    <link rel="stylesheet" href="../css/n-news.css">
    <link rel="stylesheet" href="../css/n-pop.css">
    <link rel="icon" href="../images/backend/n_logo.png">
</head>
<body>
    <div id="app">
        <header class="n-news_header">
            <div class="n-news_logo">
                <img src="../images/backend/n_logo.png" alt="" srcset="">
                <p>小春堂後臺管理</p>
            </div>
               
            <div class="n-news_logout" @click='log_out'>
                <p>帳號登出</p>
                <img src="../images/backend/log-out.png" alt="" srcset="">
            </div>
        </header>

        <main class="n-news_main">
            <div class="n-news_left">
                <a v-for = 'btn in mainbtn' :href="btn.url">{{btn.name}}</a>
            </div>

            <div class="n-news_right">

                <form action="" method="get" id="">
                    <p>消息管理</p>

                    <div class="n-news_newsbtn">
                        <button class="n-news_add" @click='new_add()' type="button">新增</button>
                    </div>
    
                    <section>
                        <input type="text" name="search" id="search" placeholder="以文章編號查詢" v-model='news_number'>    
                        <label for="search" :class="{'-active':news_number}">搜尋</label>
                    </section>
                </form>

                <div>
                    <ul class="n-news_title">
                        <li v-for = 'title in titles'>{{title}}</li>
                        <li></li>
                    </ul>

                    <ul v-for='(news,key) in newss' class="n-news_news">                              
                        <li>{{news.news_id}}</li>
                        <li>{{news.create_date}}</li>
                        <li>{{n_sort_list[news.news_class]}}</li>
                        <li>{{news.news_title1}}</li>
                        <li :class="{'-active2':newss[key].news_status == '0'}">{{on_off_list[news.news_status]}}</li> 
                        <li>{{news.news_update}}</li>
                        <li @click='edit(key)'>編輯與查看</li>
                    </ul>                
                </div>
            </div>
        </main>

        <footer class="n-news_footer">
            <ul>
                <li v-for='page in pages'>{{page.page}}</li>
            </ul>
        </footer>

        <div class="n-news_edit" v-if='current_edit !== null'>
        <!-- <div class="n-news_edit" v-if='true'> -->

            <p>編輯與查看</p>
            
            <div class="n-news_news_mid">
                <ul>                    
                    <li>
                        <section>文章分類:
                            <select name="status" id="" v-model='n_sort'>
                                <option value="0">新品上市</option>
                                <option value="1">活動消息</option>
                                <option value="2">媒體報導</option>
                                <option value="3">店鋪新資訊</option>
                            </select>
                        </section>
                    
                        <section>上下架:
                            <select name="status" id="" v-model='on_off'>
                                <option value="0">下架</option>
                                <option value="1">上架</option>
                            </select>
                        </section>
                    </li>

                    <li>
                        <label for="">主標題:</label>
                        <input type="text" v-model='n_main_title'>
                    </li>

                    <li>
                        <label for="">副標題:</label>
                        <input type="text" v-model='n_sec_title'>
                    </li>

                    <li>
                        <label for="">內文01:</label>
                        <textarea name="" id="" cols="73" rows="5" v-model='n_main_content'></textarea>
                    </li>
                    
                    <li>
                        <label for="">內文02:</label>
                        <textarea name="" id="" cols="73" rows="5" v-model='n_sec_content'></textarea>
                    </li>

                </ul>
            </div>

            <div class="n-news_news_bot">

                <div class="n-news_group" v-for='(img_name, index) in img_names'>
                    <label :for='index'>{{img_name}}:</label>
                    <input type="file" :id="index" @change='upload_img'>
                    <p>請選擇圖片上傳</p>
                    <div class="n-news_img">
                        <img src=''>
                        <p>請選擇圖片上傳</p>
                    </div>
                </div> 

            </div>

            <div class="n-news_editbtn">
                <button class="n-news_close" @click='n_close'>關閉</button>
                <button class="n-news_save" @click='n_save'>儲存</button>
            </div>
        </div>

        <div id="hide" v-if='current_edit !== null'></div>

        <news-add v-if='new_edit' @nclose='closennn' @nsave='savennn'></news-add>
        <double-check v-if='dbcheck' @save='sss' @cancel='ccc'></double-check>

    </div>

    <script src="../js/vue.js"></script>
    <script>
        Vue.component('double-check', {            
            template: 
                ` 
                <div class="dbc">
                    <section></section>
                    <p>尚未存檔，是否確認關閉</p>
                    <div>
                        <button type="button" @click='sure'>確認</button>
                        <button type="button" @click='cancel'>取消</button>
                    </div>
                </div>                
                `
            ,
            methods:{
                sure(){
                    this.$emit('save')
                },
                cancel(){
                    this.$emit('cancel')
                }
            },
        });

        Vue.component('news-add', {
            data(){
                return{  //組件的變數寫在這裡
                    n_sort:0,
                    on_off:0,
                    n_main_title:'',
                    n_sec_title:'',
                    n_main_content:'',
                    n_sec_content:'',
                    img_names:['右上圖', '主題', '圖片01', '圖片02', '圖片03'],
                };
            },
        
            template: `
                <div>
                    <div class="n-news_edit">

                        <p>新增消息</p>
                            
                        <div class="n-news_news_mid">
                            <ul>                    
                                <li>
                                    <section>文章分類:
                                        <select name="status" id="" v-model='n_sort'>
                                            <option value="0">新品上市</option>
                                            <option value="1">活動消息</option>
                                            <option value="2">媒體報導</option>
                                            <option value="3">店鋪新資訊</option>
                                        </select>
                                    </section>
                                
                                    <section>上下架:
                                        <select name="status" id="" v-model='on_off'>
                                            <option value="0">下架</option>
                                            <option value="1">上架</option>
                                        </select>
                                    </section>
                                </li>

                                <li>
                                    <label for="">主標題:</label>
                                    <input type="text" v-model='n_main_title'>
                                </li>

                                <li>
                                    <label for="">副標題:</label>
                                    <input type="text" v-model='n_sec_title'>
                                </li>

                                <li>
                                    <label for="">內文01:</label>
                                    <textarea name="" id="" cols="73" rows="5" v-model='n_main_content'></textarea>
                                </li>
                                
                                <li>
                                    <label for="">內文02:</label>
                                    <textarea name="" id="" cols="73" rows="5" v-model='n_sec_content'></textarea>
                                </li>

                            </ul>
                        </div>

                        <div class="n-news_news_bot">

                            <div class="n-news_group" v-for='(img_name, index) in img_names'>
                                <label :for='index'>{{img_name}}:</label>
                                <input type="file" :id="index" @change='upload_img'>
                                <p>請選擇圖片上傳</p>
                                <div class="n-news_img">
                                    <img src=''>
                                    <p>請選擇圖片上傳</p>
                                </div>
                            </div> 

                        </div>

                        <div class="n-news_editbtn">
                            <button class="n-news_close" @click='n_close'>關閉</button>
                            <button class="n-news_save" @click='n_save'>儲存</button>
                        </div>

                    </div>

                    <div id="hide"></div>
                </div>

            `,
            methods:{
                n_close(){ 
                    this.$emit('nclose');
                },  
                n_save(){   

                    this.$emit('nsave', this.n_sort, this.on_off, this.n_main_title, this.n_sec_title, this.n_main_content, this.n_sec_content);

                },

                upload_img(e){

                    var files = e.target.files || e.dataTransfer.files;
                    let file = files[0];

                    e.target.nextElementSibling.innerText = file.name;

                    let readFile = new FileReader();
                    readFile.readAsDataURL(file);
                    readFile.addEventListener("load", function () {

                        e.target.nextElementSibling.nextElementSibling.querySelector('img').src = readFile.result; 

                        e.target.nextElementSibling.nextElementSibling.querySelector('p').style.opacity=0;

                    });
                },
            }  
        });


        new Vue({
            el: '#app',
            data:{
                dbcheck:false,
                new_edit:false,

                img_names:['右上圖', '主題', '圖片01', '圖片02', '圖片03'],

                news_number:'',
                on_off_list:['下架', '上架'],
                n_sort_list:['新品上市', '活動消息', '媒體報導', '店鋪新資訊'],
                n_main_title:'',
                n_sec_title:'',
                n_sort:0,
                on_off:0,       
                n_main_content:'',
                n_sec_content:'',                  


                mainbtn: [  
                    {name:"會員管理", url: "./n-member.html"},
                    {name:"訂單管理", url: "./n-order.html"},
                    {name:"商品管理", url: "./n-product.html"},
                    {name:"客製化商品管理", url: "./n-customized.html"},
                    {name:"消息管理", url: "./n-news.html"},
                    {name:"折扣碼管理", url: "./n-discount.html"},
                    {name:"Q&A", url: "./n-faq.html"},
                ],
                titles: ['文章編號', '上架日期', '文章分類', '標題', '上下架', '最後更新日期', ''],
                newss:[
                    {
                        'news_id':'1234567890',
                        'create_date':'2021/01/01',
                        'news_class':0,
                        'news_title1':'新品上市新品上市新品上市新品上市新品上市',
                        'news_title2':'2新品上市新品上市新品上市新品上市新品上市',
                        'news_status':0,
                        'news_update':'2021/03/01 16:16',
                        'news_content1':'這就是內文',
                        'news_content2':'2這就是內文',
                    },
                    {
                        'news_id':'1234567890',
                        'create_date':'2021/01/01',
                        'news_class':0,
                        'news_title1':'新品上市新品上市新品上市新品上市新品上市新品上市新品上市新品上市新品上市新品上市',
                        'news_title2':'2新品上市新品上市新品上市新品上市新品上市',
                        'news_status':0,
                        'news_update':'2021/03/01 16:16',
                        'news_content1':'這就是內文',
                        'news_content2':'2這就是內文',
                    },
                    {
                        'news_id':'1234567890',
                        'create_date':'2021/01/01',
                        'news_class':0,
                        'news_title1':'新品上市新品上市新品上市新品上市新品上市',
                        'news_title2':'2新品上市新品上市新品上市新品上市新品上市',
                        'news_status':0,
                        'news_update':'2021/03/01 16:16',
                        'news_content1':'這就是內文',
                        'news_content2':'2這就是內文',
                    }
                ],
                pages:[
                    {page:"<", url: "#"},
                    {page:"1", url: "#"},
                    {page:"2", url: "#"},
                    {page:"3", url: "#"},
                    {page:"4", url: "#"},
                    {page:"5", url: "#"},
                    {page:"...", url: "#"},
                    {page:"20", url: "#"},
                    {page:">", url: "#"},
                ],
                current_edit:null,
            },

            methods: {
                edit(index){                    
                    this.current_edit = index;     

                    this.n_sort = this.newss[index].news_class;
                    this.on_off = this.newss[index].news_status;
                    this.n_main_title = this.newss[index].news_title1;
                    this.n_sec_title = this.newss[index].news_title2;
                    this.n_main_content = this.newss[index].news_content1;
                    this.n_sec_content = this.newss[index].news_content2;
                },

                n_close(){       
                    this.dbcheck=true;
                    let edit_z = document.querySelector('.n-news_edit');
                    edit_z.style.opacity = 0;
                },  

                sss(){
                    this.current_edit = null;
                    this.dbcheck=false;
                    let edit_z = document.querySelector('.n-news_edit');
                    edit_z.style.opacity = 1;

                    this.new_edit = false;
                },

                ccc(){
                    this.dbcheck=false;
                    let edit_z = document.querySelector('.n-news_edit');
                    edit_z.style.opacity = 1;
                },

                n_save(){     

                    let n_index = this.$data.current_edit;

                    this.newss[n_index].news_status = this.on_off;
                    this.newss[n_index].news_class = this.n_sort;
                    this.newss[n_index].news_title1 = this.n_main_title;
                    this.newss[n_index].news_title2 = this.n_sec_title;
                    this.newss[n_index].news_content1 = this.n_main_content;
                    this.newss[n_index].news_content2 = this.n_sec_content;


                    this.current_edit = null;
                },  

                upload_img(e){

                    var files = e.target.files || e.dataTransfer.files;
                    let file = files[0];

                    e.target.nextElementSibling.innerText = file.name;

                    let readFile = new FileReader();
                    readFile.readAsDataURL(file);
                    readFile.addEventListener("load", function () {

                        e.target.nextElementSibling.nextElementSibling.querySelector('img').src = readFile.result; 

                        e.target.nextElementSibling.nextElementSibling.querySelector('p').style.opacity=0;
                     
                    });
                },

                new_add(){
                    this.new_edit = true;
                    // this.current_edit = "notnull";
                },
                closennn(){
                    // this.new_edit = false;

                    this.dbcheck=true;
                    let edit_z = document.querySelector('.n-news_edit');
                    edit_z.style.opacity = 0;
                },
                savennn(n_sort, on_off, n_main_title, n_sec_title, n_main_content, n_sec_content){
                    this.new_edit = false;

                    // console.log(f_sort);

                    let today = new Date()
                    let y_today = today.getFullYear()
                    let m_today = today.getMonth()+1
                    if(m_today < 10 ){
                        m_today = '0'+m_today
                    }
                    let d_today = today.getDate()
                    if(d_today < 10 ){
                        d_today = '0'+d_today
                    }
                    let h_today = today.getHours()
                    if(h_today < 10 ){
                        h_today = '0'+h_today
                    }
                    let min_today = today.getMinutes()
                    if(min_today < 10 ){
                        min_today = '0'+min_today
                    }
                    let u_today = y_today +'/'+ m_today +'/'+ d_today      
                    let last_today = `${y_today}/${m_today}/${d_today} ${h_today}:${min_today}`


                    let nnn = 
                    {      
                        'news_id':'1234567890',
                        'create_date':u_today,  
                        'news_class':parseInt(n_sort),
                        'news_title1':n_main_title,
                        'news_title2':n_sec_title,
                        'news_status':parseInt(on_off),
                        'news_update':last_today,
                        'news_content1':n_main_content,
                        'news_content2':n_sec_content,
                    }

                    // console.log(nnn);

                    this.newss.unshift(nnn);
                },
                log_out(){
                    location.href = "./n-login.html"
                }
                
                
            },
            
        })
    </script>
</body>
</html>